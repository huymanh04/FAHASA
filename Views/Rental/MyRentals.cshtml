@model IEnumerable<SportsStore.Models.ViewModels.RentalViewModel>

@{
    ViewData["Title"] = "Lịch sử thuê sách của bạn";
    Layout = "_ProfileLayout";
}

<style>
    .rentals-header {
        text-align: center;
        margin-bottom: 40px;
        padding-bottom: 30px;
        border-bottom: 2px solid #f0f0f0;
    }

    .rentals-header h4 {
        font-size: 2rem;
        font-weight: 700;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        margin-bottom: 20px;
    }

    .rental-card {
        background: white;
        border-radius: 20px;
        padding: 25px;
        margin-bottom: 25px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
        border: 1px solid #e0e0e0;
        transition: all 0.3s ease;
    }

    .rental-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.12);
    }

    .rental-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 20px;
        padding-bottom: 20px;
        border-bottom: 2px solid #f0f0f0;
        flex-wrap: wrap;
        gap: 15px;
    }

    .book-title {
        font-size: 1.3rem;
        font-weight: 700;
        color: #333;
        margin-bottom: 10px;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .book-title i {
        color: #667eea;
    }

    .rental-info {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 20px;
    }

    .info-item {
        display: flex;
        flex-direction: column;
        gap: 5px;
    }

    .info-label {
        font-size: 0.85rem;
        color: #666;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .info-value {
        font-size: 1rem;
        color: #333;
        font-weight: 600;
    }

    .status-badge {
        padding: 8px 20px;
        border-radius: 20px;
        font-weight: 600;
        font-size: 0.9rem;
        display: inline-block;
    }

    .status-waiting {
        background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
        color: white;
    }

    .status-renting {
        background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
        color: white;
    }

    .status-overdue {
        background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
        color: white;
        animation: pulse 2s infinite;
    }

    .status-returned {
        background: linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%);
        color: white;
    }

    .remaining-days {
        font-size: 1.2rem;
        font-weight: 700;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }

    .alert-overdue {
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        color: white;
        padding: 15px 20px;
        border-radius: 12px;
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        gap: 10px;
        font-weight: 600;
        box-shadow: 0 4px 15px rgba(245, 87, 108, 0.3);
    }

    .rental-actions {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        margin-top: 20px;
        padding-top: 20px;
        border-top: 2px solid #f0f0f0;
    }

    .btn-action {
        padding: 10px 20px;
        border-radius: 12px;
        font-weight: 600;
        text-decoration: none;
        transition: all 0.3s ease;
        border: none;
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        gap: 8px;
    }

    .btn-cancel {
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        color: white;
        box-shadow: 0 4px 15px rgba(245, 87, 108, 0.3);
    }

    .btn-cancel:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(245, 87, 108, 0.4);
        color: white;
    }

    .btn-confirm {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
    }

    .btn-confirm:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        color: white;
    }

    .empty-state {
        text-align: center;
        padding: 60px 20px;
        background: white;
        border-radius: 20px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
    }

    .empty-state-icon {
        font-size: 4rem;
        color: #ccc;
        margin-bottom: 20px;
    }

    .empty-state h5 {
        color: #666;
        font-weight: 600;
        margin-bottom: 10px;
    }

    .empty-state p {
        color: #999;
    }

    @@keyframes pulse {
        0%, 100% {
            opacity: 1;
        }
        50% {
            opacity: 0.7;
        }
    }

    @@media (max-width: 768px) {
        .rental-header {
            flex-direction: column;
        }

        .rental-info {
            grid-template-columns: 1fr;
        }

        .rental-actions {
            flex-direction: column;
        }

        .btn-action {
            width: 100%;
            justify-content: center;
        }
    }
</style>

<div class="rentals-header">
    <h4>
        <i class="fas fa-book me-2"></i>
        Lịch sử thuê sách
    </h4>
</div>

    @if (!Model.Any())
    {
    <div class="empty-state">
        <div class="empty-state-icon">
            <i class="fas fa-book-open"></i>
        </div>
        <h5>Bạn chưa thuê cuốn sách nào</h5>
        <p>Hãy khám phá thư viện sách của chúng tôi và bắt đầu thuê sách ngay hôm nay!</p>
    </div>
    }
    else
    {
    foreach (var r in Model)
    {
        <div class="rental-card">
            <div class="rental-header">
                <div class="book-title">
                    <i class="fas fa-book"></i>
                    @r.BookTitle
                </div>
                <div>
                    <span class="status-badge @GetStatusClass(r)">
                                    @r.StatusText
                                </span>
                </div>
            </div>

                                @if (r.IsOverdue)
                                {
                <div class="alert-overdue">
                    <i class="fas fa-exclamation-triangle"></i>
                    <span>@r.OverdueMessage</span>
                </div>
            }

            <div class="rental-info">
                <div class="info-item">
                    <span class="info-label">
                        <i class="fas fa-calendar-check me-1"></i>
                        Ngày bắt đầu
                    </span>
                    <span class="info-value">@r.StartDate.ToString("dd/MM/yyyy")</span>
                </div>

                <div class="info-item">
                    <span class="info-label">
                        <i class="fas fa-calendar-times me-1"></i>
                        Ngày kết thúc
                    </span>
                    <span class="info-value">@r.EndDate.ToString("dd/MM/yyyy")</span>
                </div>

                <div class="info-item">
                    <span class="info-label">
                        <i class="fas fa-clock me-1"></i>
                        Còn lại
                    </span>
                    @if (r.IsReturned)
                                {
                        <span class="info-value text-muted">-</span>
                                }
                                else
                                {
                        <span class="remaining-days">@r.RemainingDays ngày</span>
                                }
                </div>
            </div>

            <div class="rental-actions">
                                @if (!r.IsDelivered)
                                {
                                    <form asp-action="CancelRental" method="post" class="d-inline">
                                        <input type="hidden" name="rentalId" value="@r.Id" />
                        <button type="submit" class="btn-action btn-cancel"
                                            onclick="return confirm('Bạn có chắc muốn hủy đơn thuê này?');">
                            <i class="fas fa-times"></i>
                            Hủy đơn thuê
                                        </button>
                                    </form>
                                }
                                else if (r.IsDelivered && !r.IsReturned)
                                {
                                    <form asp-action="ConfirmReturn" method="post" class="d-inline">
                                        <input type="hidden" name="rentalId" value="@r.Id" />
                        <button type="submit" class="btn-action btn-confirm"
                                            onclick="return confirm('Xác nhận đã trả hàng?');">
                            <i class="fas fa-check-circle"></i>
                            Xác nhận trả hàng
                                        </button>
                                    </form>
                                }
                                else
                                {
                    <span class="text-muted">
                        <i class="fas fa-check-circle me-1"></i>
                        Đã hoàn tất
                    </span>
                                }
            </div>
        </div>
    }
}

@functions {
    string GetStatusClass(SportsStore.Models.ViewModels.RentalViewModel r)
    {
        if (r.IsReturned)
            return "status-returned";
        if (r.IsOverdue)
            return "status-overdue";
        if (r.IsDelivered)
            return "status-renting";
        return "status-waiting";
    }
}
